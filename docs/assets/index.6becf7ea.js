import{S as e,P as n,W as i,G as s,a as o,M as t,D as a,b as r,c as d,d as c,e as l,f as u,C as p,B as f,V as h,g as w,h as y,i as g,j as m,R as S,k as v,l as x,m as P,Q as L,n as C,o as k}from"./vendor.c13689b0.js";var M=0,B=1,F=document.querySelector("#app");const z=document.querySelector("#sim-menu"),q=document.getElementById("sim-button"),E=document.getElementById("free-drive-button");var I=document.querySelector("#info");function W(){var z,q,E,W,R,U=F.clientWidth,b=F.clientHeight,K=new e,V=new n(75,U/b,.001,100),A=new i({antialias:!0,alpha:!0}),T=[],j=[],D=new s;!function(){A.setPixelRatio(window.devicePixelRatio),A.setSize(U,b),null==F||F.appendChild(A.domElement),window.addEventListener("resize",(function(){U=null==F?void 0:F.clientHeight,b=null==F?void 0:F.clientHeight,V.aspect=U/b,V.updateProjectionMatrix(),A.setSize(U,b)}));var e,n=new o(10,10,10),i=new t({color:13373730,side:a});(e=new r(n,i)).rotation.x=Math.PI/2,K.add(e),n=new o(10,10,10),i=new t({color:65314,side:a}),(e=new r(n,i)).rotation.x=Math.PI/2,e.position.set(0,0,100),K.add(e);var s=new d(16777215,1);s.position.set(-10,10,0),K.add(s),(E=new c).broadphase=new l(E),E.gravity.set(0,-9.81,0),E.defaultContactMaterial.friction=0;var C=new u("groundMaterial"),k=new u("wheelMaterial"),M=new p(k,C,{friction:2,restitution:5,contactEquationStiffness:100,contactEquationRelaxation:8,frictionEquationStiffness:100});E.addContactMaterial(M);var B=new f(new h(1,.3,2));(W=new w({mass:1600})).addShape(B),W.position.set(0,1,0),W.angularVelocity.set(0,0,0);const I=new y(500,100);K.add(I);var R=new g(2,.6,4),D=new m({color:1048575,emissive:11655351,side:a,flatShading:!0});z=new r(R,D),K.add(z),q=new S({chassisBody:W,indexRightAxis:0,indexUpAxis:1,indexForwardAxis:2});var H={radius:.3,directionLocal:new h(0,-1,0),suspensionStiffness:50,suspensionRestLength:.75,frictionSlip:2.5,dampingRelaxation:2.3,dampingCompression:4.5,maxSuspensionForce:2e5,rollInfluence:.01,axleLocal:new h(-1,0,0),chassisConnectionPointLocal:new h(1,1,0),maxSuspensionTravel:.3,customSlidingRotationalSpeed:-1,useCustomSlidingRotationalSpeed:!0},G=.7;H.chassisConnectionPointLocal.set(G,0,-1),q.addWheel(H),H.chassisConnectionPointLocal.set(-.7,0,-1),q.addWheel(H),H.chassisConnectionPointLocal.set(G,0,1),q.addWheel(H),H.chassisConnectionPointLocal.set(-.7,0,1),q.addWheel(H),q.addToWorld(E),q.wheelInfos.forEach((function(e){var n=new v(e.radius,e.radius,e.radius/2,20),i=new w({mass:8,material:k}),s=new L;s.setFromAxisAngle(new h(1,0,0),Math.PI/2),i.addShape(n,new h,s),T.push(i);var o=new x(e.radius,e.radius,.4,32),t=new m({color:13668381,emissive:1114538,side:a,flatShading:!0}),d=new r(o,t);d.geometry.rotateZ(Math.PI/2),j.push(d),K.add(d)})),E.addEventListener("postStep",(function(){for(var e=0;e<q.wheelInfos.length;e++){q.updateWheelTransform(e);var n=q.wheelInfos[e].worldTransform;T[e].position.copy(n.position),T[e].quaternion.copy(n.quaternion),j[e].position.copy(n.position),j[e].quaternion.copy(n.quaternion)}}));var Q=e.quaternion,Z=new w({mass:0,material:C,shape:new P,quaternion:new L(-Q.x,Q.y,Q.z,Q.w)});E.addBody(Z)}();const H=new h(0,0,100),G={Kp:480,Kd:900,Ki:0};if(2==M){const e=D.addFolder("Control Constants");e.add(G,"Kp",-200,2e3,10),e.add(G,"Ki",-200,2e3,10),e.add(G,"Kd",-200,2e3,10),e.open()}var Q=0,Z=1/60,J=0,N=0;const O={engineForceLimit:3e3,SteeringValLimit:.3,brakeForceLimit:200},X=D.addFolder("Car Constants");function Y(e){e>O.engineForceLimit&&(e=O.engineForceLimit),e<-O.engineForceLimit&&(e=-O.engineForceLimit);for(let n=0;n<4;n++)q.applyEngineForce(e,n)}function $(e){for(let n=0;n<2;n++)q.setBrake(e,n)}function _(e){q.setSteeringValue(e,2),q.setSteeringValue(e,3)}function ee(){Y(0)}function ne(){_(0)}X.add(O,"engineForceLimit",0,1e4,10),X.add(O,"SteeringValLimit",0,1,.01),X.add(O,"brakeForceLimit",0,1e3,10),X.open();let ie=new Map;function se(e){"keydown"==e.type&&(ie.get(e.keyCode)&&ie.set(e.keyCode,{pressed:!0,funcPress:ie.get(e.keyCode).funcPress,funcUnPress:ie.get(e.keyCode).funcUnPress}),function(e){switch(e){case 49:B=1;break;case 50:B=2}}(e.keyCode)),"keyup"==e.type&&ie.get(e.keyCode)&&ie.set(e.keyCode,{pressed:!1,funcPress:ie.get(e.keyCode).funcPress,funcUnPress:ie.get(e.keyCode).funcUnPress})}function oe(){switch(B){case 1:e=new C(0,4,-6).applyMatrix4(z.matrixWorld),V.position.x=e.x,V.position.y=e.y,V.position.z=e.z,V.lookAt(new C(q.chassisBody.position.x,q.chassisBody.position.y,q.chassisBody.position.z));break;case 2:!function(){var e;e=new C(-10,4,-18).applyMatrix4(z.matrixWorld),V.position.x=e.x,V.position.y=e.y,V.position.z=e.z,V.lookAt(new C(q.chassisBody.position.x,q.chassisBody.position.y,q.chassisBody.position.z))}()}var e}ie.set(87,{pressed:!1,funcPress:function(){Y(-O.engineForceLimit)},funcUnPress:ee}),ie.set(32,{pressed:!1,funcPress:function(){$(O.brakeForceLimit)},funcUnPress:function(){$(0)}}),ie.set(83,{pressed:!1,funcPress:function(){Y(O.engineForceLimit)},funcUnPress:ee}),ie.set(68,{pressed:!1,funcPress:function(){_(-O.SteeringValLimit)},funcUnPress:ne}),ie.set(65,{pressed:!1,funcPress:function(){_(O.SteeringValLimit)},funcUnPress:ne}),window.addEventListener("keydown",se),window.addEventListener("keyup",se);var te="";var ae,re="timeless";function de(){var e;requestAnimationFrame(de),function(){for(let[e,n]of ie)n.pressed?n.funcPress():32!=e&&68!=e&&87!=e||n.funcUnPress()}(),2==M&&(e=W.position.z-H.z,Y(N=G.Kp*e+G.Ki*J*Z+G.Kd*(e-Q)/Z),Q=e,J+=e),oe(),A.render(K,V),E.step(1/60),z.position.copy(new C(W.position.x,W.position.y,W.position.z)),z.quaternion.copy(new k(W.quaternion.x,W.quaternion.y,W.quaternion.z,W.quaternion.w)),ae=String((Date.now()-R)/1e3),I.innerText="Signal: "+String(Math.round(N))+"\nEngineForce Left Rear Wheel:"+String(Math.round(q.wheelInfos[2].engineForce))+"\nEngineForce Right Rear Wheel:"+String(Math.round(q.wheelInfos[3].engineForce))+"\nSteering:"+String(q.wheelInfos[2].steering)+"\nBody Position:  x: "+String(Math.round(q.chassisBody.position.x))+", y: "+String(Math.round(q.chassisBody.position.y))+" , z: "+String(Math.round(q.chassisBody.position.z))+"\nVehicle.sliding:"+String(q.sliding)+"\nChassisBody.velocity  x: "+String(Math.round(q.chassisBody.velocity.x))+", y: "+String(Math.round(q.chassisBody.velocity.y))+" , z: "+String(Math.round(q.chassisBody.velocity.z))+"\nTime (Seconds): "+ae,"timeless"==re&&0==Math.round(q.chassisBody.velocity.z)&&100==Math.round(q.chassisBody.position.z)&&(te="\nWinning Time (Seconds): "+(re=ae),window.alert(te))}R=Date.now(),2==M?setTimeout((()=>{de()}),3e3):de()}z.classList.remove("hidden"),E&&E.addEventListener("click",(function(){M=1,B=1,W(),z.classList.add("hidden")})),q&&q.addEventListener("click",(function(){M=2,B=2,W(),z.classList.add("hidden")}));
